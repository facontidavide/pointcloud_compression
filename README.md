# Experimental software to benchmark PCL compression

Lossy compression for pointclouds generated by LIDARs.

- It preserves the number of points and their order.
- No voxelization.
- Limitation: works only for `pcl::PointXYZ` and `pcl::PointXYZI` (but can be fixed easily).

Vanilla lossless ZSTD and LZ4 compression are added for reference.

Work in progress. Nevertheless, **YOU** can help.

Run this app on an existing rosbag containing a `sensors_msgs/PointCloud2` message generated by a LIDAR.

In [Releases](https://github.com/facontidavide/pointcloud_compression/releases), you should find an AppImage that can run directly in Ubuntu 22.04.

## Motivation

PointCloud messages in ROS are usually very large.

This means that rosbags containing point clouds tend to be very large and streaming these messages over wireless network can be slow
or prohibitive.

Our friend (or foe?) DDS doesn't make things any easier (on the contrary).

[Google Draco](https://github.com/google/draco) provides an effective way to compress point clouds, but its KD-tree based
algorithm will change the order and number of points in the cloud.

Unfortunately, some algorithms, being LOAM (Lidar odometry) a notable example, use hard-coded assumptions about the order 
of the points, for instance, to calculate corners or flat surfaces.

My codec tries to preserve the original point cloud order and keep compression time as short as possible.

## How to run

The first command line argument is the path to the rosbag.

Expected output (example):

```
Topic: /pandar_xt_32_0_lidar
  Count: 100
  [LZ4]  ratio: 0.529 time (usec): 2664
  [ZSTD] ratio: 0.474 time (usec): 5521
  [Lossy + LZ4]  ratio: 0.230 time (usec): 3348
  [Lossy + ZSTD] ratio: 0.197 time (usec): 4568
```

## About the Lossy compression

A quantization of 1mm is applied to the X, Y, Z channels. All the other channels have no loss in accuracy.
